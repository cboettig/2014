---
layout: post
title: Generating Bubble Charts
category: visualization
tags: [altmetrics, bubblechart, alm]
authors:
 - name: Martin Fenner
   orcid: http://orcid.org/0000-0003-1419-2405
   email: mfenner@plos.org
excerpt: We want to visualize three dimensions of a dataset.
code: true
---

## Problem

We want to visualize three dimensions of a dataset.

## Solution

Bubble charts can help visualize three quantitative dimensions. In addition to the X and Y axis they use the bubble size, plus an optional 4th dimension using color.

## Discussion

Bubble charts are helpful for visualizing altmetrics for a large set of articles, e.g. all articles published by a journal in a given year. Source data in CSV format available [here](/docs/data/alm_report_plos_biology_2013-05-20.csv).

Load required libraries

```{r results = "hide"}

library(knitr)
local({
  hook_plot = knit_hooks$get('plot')
  knit_hooks$set(plot = function(x, options) {
    x = paste(x, collapse = '.')
    if (!grepl('\\.svg', x)) return(hook_plot(x, options))
    # read the content of the svg image and write it out without <?xml ... ?>
    paste(readLines(x)[-1], collapse = '\n')
  })
})
opts_chunk$set(dev='svg')


library(plyr)
```

```{r}
alm <- read.csv("http://ropensci.github.io/docs/data/alm_report_plos_biology_2013-05-20.csv", stringsAsFactors=FALSE, na.strings=c("0"))
```

Only look at papers published in 2010

```{r}
alm$publication_date <- as.Date(alm$publication_date)
alm <- subset(alm, alm$publication_date > "2010-01-01" & alm$publication_date <= "2010-12-31")
```

Make sure `counter` values are numbers

```{r}
alm$counter_html <- as.numeric(alm$counter_html)
```

Lump all papers together that are not research articles

```{r}
reassignType <- function(x) if (x == "Research Article") 1 else 0
alm$article_group <- aaply(alm$article_type, 1, reassignType)
```

Calculate article age in months

```{r}
alm$age_in_months <- (Sys.Date() - alm$publication_date) / 365.25 * 12
start_age_in_months <- floor(as.numeric(Sys.Date() - as.Date(strptime("2010-12-31", format = "%Y-%m-%d"))) / 365.25 * 12)
```

Create chart variables

```{r}
x <- alm$age_in_months
y <- alm$counter
z <- alm$scopus

xlab <- "Age in Months"
ylab <- "Total Views"

labels <- alm$article_group
col.main <- "#1ebd21"
col <- "#666358"
```

Calculate bubble diameter and color

```{r}
z <- sqrt( z / pi )
getColor <- function(x) c("#c9c9c7", "#1ebd21")[x+1]
colors <- aaply(labels, 1, getColor)
```

Plot the chart

```{r 2013-12-11_figure_3, fig.cap="**Figure 3. Citation counts for PLOS Biology articles published in 2010.** Scopus citation counts plotted as a probability distribution for all 197 *PLOS Biology* research articles published in 2010. Data collected May 20, 2013. Median 19 citations; 10% of papers have at least 50 citations. From Fenner [-@fenner_2013]."}

opar <- par(mai=c(0.5,.75,0.5,0.5), omi=c(0.25,0.1,0.25,0.1), mgp=c(3,.5,.5), fg="black", cex=1, cex.main=2, cex.lab=1.5, col="white", col.main=col.main, col.lab=col)

plot(x, y, type = "n", xlim=c(start_age_in_months,start_age_in_months+13), ylim=c(0,60000), xlab=NA, ylab=NA, las=1)
symbols(x, y, circles=z, inches=exp(1.3)/15, bg=colors, xlim=c(start_age_in_months,start_age_in_months+13), ylim=c(0,ymax), xlab=NA, ylab=NA, las=1, add=TRUE)
mtext(xlab, side=1, col=col.main, cex=1.25, outer=TRUE, adj=1, at=1)
mtext(ylab, side=2, col=col.main, cex=1.25, outer=TRUE, adj=0, at=1, las=1)

par(opar)
```

A good number of observations for bubble charts is 50 to 500 data points. Alternatives for smaller sample sizes are dot plots and heat maps.

## References
