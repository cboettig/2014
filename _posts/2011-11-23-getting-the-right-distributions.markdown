---
comments: true
date: 2011-11-23 15:43:27
layout: post
slug: getting-the-right-distributions
title: Getting the right distributions
redirects: [/wordpress/archives/3325, /archives/3325]
categories:
- ecology
tags:
- pdg-control
---

Determining the stochastic transition matrix is the essential computational step of SDP solution.  If stochasticity enters only in the growth process: 

$$x_{t+1} = z_t f(x_t) $$

where $z_t$ is a draw from a log-normal density distribution function $ \log \mathcal{N} (x; \mu, \sigma) $, then the probability that $x_{t+1}$ falls within a bin $ [x_i-\Delta,x_i+\Delta] $ given that at it is currently at $x_t = y$ is

$$ P([x_i-\Delta,x_i+\Delta] |y) = \int_{x-\Delta}^{x+\Delta} \log \mathcal{N}(x; \log(f(y)) + \mu, \sigma) dx$$

Note that we are discritizing the transition matrix to a grid of values $ x_i $ at time $t$ to $ x_j$ at time $t+1$, hence the binning question, where $ \Delta $ is half the grid bin width.  

Another note: Let us assume z_t is mean unity; only logical for the growth equation.  In the case of the log-normal, the parameter $ \mu $ is the log mean, thus:  $ z_t =  \ln \mathcal{N} (x; \log(1) - \sigma^2/2, \sigma) $.   



###  Computational implementation / comparison 



 On a fine grid, this seems to be the same as just evaluating the density at the midpoint and normalizing. 

For instance, we could integrate following the definition above: 

```R

bw <- (x_grid[2] - x_grid[1]) / 2 # we'll go from the midpoint
F <- function(x) dlnorm(x, log(f(y,h,p)) - sigma_g ^ 2 / 2, sigma_g)
Prob <- sapply(x_grid, function(x) integrate(F, x - bw, x + bw)[[1]] )
Prob/sum(Prob)

```


which seems to get us the same thing as evaluating the density directly at the midpoint:


```R

Prob <- sapply(x_grid, dlnorm(x, log(f(y)) - sigma^2/2, sigma))
Prob/sum(Prob)

```

Note also that because we're normalizing, we could just as easily rescaled the state by the mean, 

```R

dlnorm(x/f(y), log(1) - sigma^2/2, sigma)

```


See [this example code](https://github.com/cboettig/pdg_control/blob/43cb4839d91f6ea310678289dbf6368739f131e3/R/SDP/unit_tests.R) (requires my[ stochastic_dynamic_programming.R ](https://github.com/cboettig/pdg_control/blob/ae2bb58ca29339d81e815e032bdffa9f17391b3f/R/SDP/stochastic_dynamic_programming.R)functions), distributions agree pretty exactly (red and blue distributions overlap exactly to look purple):

![](data:image/png;base64,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)




###  Adding additional sources of uncertainty 



In the above, next year's population is uncertain but this year's is known perfectly.  Imagine the current value of the stock $x_t $, is a random deviate from the value we measured $m_t$, given by the probability density $ P_m(x_t) $, and the harvest level will be a random variate around whatever level we set for the quota, given from the distribution P_q(h).  Both of these introduce uncertainty into the expected value of stock next year, $f(x_t,h_t)$:

$$ P([x_i,x_i+\Delta] |m_t, q_t) = $$
$$  \int_x^{x+\Delta} dx  \int_0^{\infty}dy \int_0^{\infty} dh\cdot \ln\mathcal{N}(x; \log(f(y,h)) + \mu, \sigma) P_q(h) P_m(y) $$


Looks like this is gonna be un-pretty.  Cubature R package is supposed to handle these higher-dimensional integrals quickly, but no luck.  Computation for even a single integral is very slow:


```R

require(cubature)
pdf_zg <- function(x, expected) dlnorm(x, log(expected)-sigma_g^2/2, sigma_g)
pdf_zm <- function(x) dlnorm(x, log(1)-sigma_m^2/2, sigma_m)
pdf_zi <- function(x,q) dlnorm(x, log(q)-sigma_i^2/2, sigma_i)
F <- function(x) pdf_zg(x[1], f(x[2],x[3],p))*pdf_zm(x[2])*pdf_zi(x[3], q)
adaptIntegrate(F, c(x_grid[i]-bw,0,0), c(x_grid[i]+bw, x_grid[gridsize], h_grid[gridsize]))

```


(See full example as [unit_test2](https://github.com/cboettig/pdg_control/blob/c6d77e639b9fe4dd575e0b276568815b9b4767ee/R/SDP/unit_test2.R))
